---
import SellerLayout from '../../../components/seller/SellerLayout.astro';
---

<SellerLayout title="Seller Dashboard - Overview" currentPage="overview">
  <!-- Seller Quick Stats Row -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div id="earnings-card"></div>
    <div id="platforms-card"></div>
    <div id="views-card"></div>
    <div id="performance-card"></div>
  </div>

  <!-- Main Dashboard Grid -->
  <div class="grid lg:grid-cols-3 gap-8 mb-8">
    <!-- Earnings Chart - Takes 2 columns -->
    <div class="lg:col-span-2">
      <div id="earnings-chart"></div>
    </div>

    <!-- Quick Actions & Status - Takes 1 column -->
    <div class="space-y-6">
      <!-- Platform Status Overview -->
      <div class="bg-gradient-to-br from-gray-900/50 to-black/50 backdrop-blur-sm rounded-2xl border border-yellow-400/20 p-6 hover:border-yellow-400/40 transition-all duration-300">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-white">Platform Status</h3>
          <a href="/dashboard/seller/listings" class="text-yellow-400 hover:text-yellow-300 text-sm font-medium">
            Manage All â†’
          </a>
        </div>

        <div class="space-y-3">
          <div class="flex items-center justify-between p-3 bg-green-400/10 border border-green-400/20 rounded-lg">
            <div class="flex items-center space-x-3">
              <div class="w-8 h-8 bg-green-400/20 rounded-lg flex items-center justify-center">
                <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <span class="text-sm font-medium text-white">Active Listings</span>
            </div>
            <span class="text-lg font-bold text-green-400">3</span>
          </div>

          <div class="flex items-center justify-between p-3 bg-orange-400/10 border border-orange-400/20 rounded-lg">
            <div class="flex items-center space-x-3">
              <div class="w-8 h-8 bg-orange-400/20 rounded-lg flex items-center justify-center">
                <svg class="w-4 h-4 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <span class="text-sm font-medium text-white">Pending Review</span>
            </div>
            <span class="text-lg font-bold text-orange-400">1</span>
          </div>

          <div class="flex items-center justify-between p-3 bg-gray-800/30 border border-gray-700 rounded-lg">
            <div class="flex items-center space-x-3">
              <div class="w-8 h-8 bg-gray-700 rounded-lg flex items-center justify-center">
                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
              </div>
              <span class="text-sm font-medium text-white">Drafts</span>
            </div>
            <span class="text-lg font-bold text-gray-400">1</span>
          </div>
        </div>

        <button class="w-full mt-4 bg-yellow-400 text-black py-2 px-4 rounded-lg font-medium hover:bg-yellow-300 transition-colors">
          List New Platform
        </button>
      </div>

      <!-- Recent Activity -->
      <div class="bg-gradient-to-br from-gray-900/50 to-black/50 backdrop-blur-sm rounded-2xl border border-yellow-400/20 p-6 hover:border-yellow-400/40 transition-all duration-300">
        <h3 class="text-lg font-semibold text-white mb-4">Recent Activity</h3>

        <div class="space-y-3">
          <div class="flex items-start space-x-3 p-3 bg-gray-800/30 rounded-lg">
            <div class="w-8 h-8 bg-green-400/20 rounded-full flex items-center justify-center flex-shrink-0">
              <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-white">Platform Sold</p>
              <p class="text-xs text-gray-400">Healthcare Analytics Suite - $28,500</p>
              <p class="text-xs text-gray-500">2 hours ago</p>
            </div>
          </div>

          <div class="flex items-start space-x-3 p-3 bg-gray-800/30 rounded-lg">
            <div class="w-8 h-8 bg-blue-400/20 rounded-full flex items-center justify-center flex-shrink-0">
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-white">New Inquiry</p>
              <p class="text-xs text-gray-400">AI HR Platform - Potential buyer wants demo</p>
              <p class="text-xs text-gray-500">5 hours ago</p>
            </div>
          </div>

          <div class="flex items-start space-x-3 p-3 bg-gray-800/30 rounded-lg">
            <div class="w-8 h-8 bg-yellow-400/20 rounded-full flex items-center justify-center flex-shrink-0">
              <svg class="w-4 h-4 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-white">Platform Approved</p>
              <p class="text-xs text-gray-400">AI HR Platform passed all validation checks</p>
              <p class="text-xs text-gray-500">1 day ago</p>
            </div>
          </div>
        </div>

        <a href="/dashboard/seller/messages" class="block w-full mt-4 text-center text-yellow-400 hover:text-yellow-300 text-sm font-medium">
          View All Activity â†’
        </a>
      </div>
    </div>
  </div>

  <!-- Performance Insights -->
  <div class="grid lg:grid-cols-2 gap-8 mb-8">
    <!-- Top Performing Platforms -->
    <div class="bg-gradient-to-br from-gray-900/50 to-black/50 backdrop-blur-sm rounded-2xl border border-yellow-400/20 p-6 hover:border-yellow-400/40 transition-all duration-300">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-semibold text-white">Top Performing Platforms</h3>
        <a href="/dashboard/seller/analytics" class="text-yellow-400 hover:text-yellow-300 text-sm font-medium">
          Detailed Analytics â†’
        </a>
      </div>

      <div class="space-y-4">
        <div class="flex items-center justify-between p-4 bg-gray-800/30 rounded-lg hover:bg-gray-800/50 transition-colors">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-yellow-400/20 rounded-lg flex items-center justify-center">
              <span class="text-xs font-semibold text-yellow-400">HR</span>
            </div>
            <div>
              <h4 class="text-sm font-medium text-white">AI HR Compliance Platform</h4>
              <p class="text-xs text-gray-400">1,245 views â€¢ 8 inquiries</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-sm font-semibold text-green-400">$35,000</div>
            <div class="text-xs text-yellow-400">Hot ðŸ”¥</div>
          </div>
        </div>

        <div class="flex items-center justify-between p-4 bg-gray-800/30 rounded-lg hover:bg-gray-800/50 transition-colors">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-blue-400/20 rounded-lg flex items-center justify-center">
              <span class="text-xs font-semibold text-blue-400">EC</span>
            </div>
            <div>
              <h4 class="text-sm font-medium text-white">E-commerce Marketplace</h4>
              <p class="text-xs text-gray-400">234 views â€¢ 3 inquiries</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-sm font-semibold text-green-400">$18,000</div>
            <div class="text-xs text-blue-400">Active</div>
          </div>
        </div>

        <div class="flex items-center justify-between p-4 bg-gray-800/30 rounded-lg opacity-60">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-gray-700 rounded-lg flex items-center justify-center">
              <span class="text-xs font-semibold text-gray-400">FT</span>
            </div>
            <div>
              <h4 class="text-sm font-medium text-white">Financial Trading Bot</h4>
              <p class="text-xs text-gray-400">Draft - Not yet published</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-sm font-semibold text-gray-400">$42,000</div>
            <div class="text-xs text-gray-500">Draft</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Earnings & Payouts -->
    <div class="bg-gradient-to-br from-gray-900/50 to-black/50 backdrop-blur-sm rounded-2xl border border-yellow-400/20 p-6 hover:border-yellow-400/40 transition-all duration-300">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-semibold text-white">Earnings & Payouts</h3>
        <a href="/dashboard/seller/earnings" class="text-yellow-400 hover:text-yellow-300 text-sm font-medium">
          Manage Payouts â†’
        </a>
      </div>

      <div class="space-y-4">
        <!-- Total Earnings -->
        <div class="bg-green-400/10 border border-green-400/20 rounded-lg p-4">
          <div class="flex items-center justify-between mb-2">
            <h4 class="text-sm font-medium text-white">Total Lifetime Earnings</h4>
            <span class="text-2xl font-bold text-green-400">$45,250</span>
          </div>
          <p class="text-xs text-gray-400">From 3 platform sales</p>
        </div>

        <!-- Pending Payouts -->
        <div class="bg-yellow-400/10 border border-yellow-400/20 rounded-lg p-4">
          <div class="flex items-center justify-between mb-2">
            <h4 class="text-sm font-medium text-white">Pending Payouts</h4>
            <span class="text-xl font-bold text-yellow-400">$28,500</span>
          </div>
          <p class="text-xs text-gray-400">Available in 3 days (escrow completion)</p>
          <div class="mt-3 w-full bg-gray-700 rounded-full h-2">
            <div class="bg-yellow-400 h-2 rounded-full" style="width: 75%"></div>
          </div>
        </div>

        <!-- Available for Withdrawal -->
        <div class="bg-gray-800/30 border border-gray-700 rounded-lg p-4">
          <div class="flex items-center justify-between mb-2">
            <h4 class="text-sm font-medium text-white">Available for Withdrawal</h4>
            <span class="text-xl font-bold text-white">$16,750</span>
          </div>
          <button class="w-full mt-3 bg-green-400 text-black py-2 px-4 rounded-lg font-medium hover:bg-green-300 transition-colors text-sm">
            Request Payout
          </button>
        </div>

        <!-- Recent Transactions */
        <div class="space-y-2">
          <h5 class="text-xs font-medium text-gray-400 uppercase tracking-wider">Recent Transactions</h5>
          <div class="space-y-2">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-300">Healthcare Analytics Sale</span>
              <span class="text-green-400 font-medium">+$28,500</span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-300">Platform Fee (5%)</span>
              <span class="text-red-400 font-medium">-$1,425</span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-300">Processing Fee</span>
              <span class="text-red-400 font-medium">-$75</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Optimization Recommendations -->
  <div class="bg-gradient-to-br from-gray-900/50 to-black/50 backdrop-blur-sm rounded-2xl border border-yellow-400/20 p-6 hover:border-yellow-400/40 transition-all duration-300">
    <div class="flex items-center justify-between mb-6">
      <div>
        <h3 class="text-lg font-semibold text-white">AI-Powered Recommendations</h3>
        <p class="text-sm text-gray-400">Boost your platform visibility and sales</p>
      </div>
      <div class="flex items-center space-x-2 bg-purple-400/10 border border-purple-400/20 rounded-lg px-3 py-2">
        <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        <span class="text-sm font-medium text-purple-400">AI Insights</span>
      </div>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div class="bg-blue-400/10 border border-blue-400/20 rounded-lg p-4">
        <div class="flex items-center space-x-2 mb-3">
          <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          <h4 class="text-sm font-medium text-white">Optimize Visibility</h4>
        </div>
        <p class="text-xs text-gray-400 mb-3">Add more technical details to increase search visibility</p>
        <button class="text-xs bg-blue-400/10 text-blue-400 px-3 py-1 rounded-full hover:bg-blue-400/20 transition-colors">
          Improve SEO
        </button>
      </div>

      <div class="bg-yellow-400/10 border border-yellow-400/20 rounded-lg p-4">
        <div class="flex items-center space-x-2 mb-3">
          <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <h4 class="text-sm font-medium text-white">Price Optimization</h4>
        </div>
        <p class="text-xs text-gray-400 mb-3">Your HR platform is competitively priced with member benefits</p>
        <button class="text-xs bg-yellow-400/10 text-yellow-400 px-3 py-1 rounded-full hover:bg-yellow-400/20 transition-colors">
          Adjust Price
        </button>
      </div>

      <div class="bg-green-400/10 border border-green-400/20 rounded-lg p-4">
        <div class="flex items-center space-x-2 mb-3">
          <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
          </svg>
          <h4 class="text-sm font-medium text-white">Quality Score</h4>
        </div>
        <p class="text-xs text-gray-400 mb-3">Your platforms have excellent reviews. Keep it up!</p>
        <button class="text-xs bg-green-400/10 text-green-400 px-3 py-1 rounded-full hover:bg-green-400/20 transition-colors">
          View Reviews
        </button>
      </div>
    </div>
  </div>
</SellerLayout>

<script>
  import {
    EarningsCard,
    PlatformsCard,
    ViewsCard,
    PerformanceCard
  } from '../../../components/seller/SellerMetricCard.tsx';
  import EarningsChart from '../../../components/seller/EarningsChart.tsx';
  import { createRoot } from 'react-dom/client';
  import React from 'react';

  // Mock data for seller dashboard
  const mockEarningsData = [
    { date: '2024-01-15', earnings: 8500, sales: 1, views: 145 },
    { date: '2024-01-16', earnings: 9200, sales: 0, views: 167 },
    { date: '2024-01-17', earnings: 9200, sales: 0, views: 189 },
    { date: '2024-01-18', earnings: 9200, sales: 0, views: 201 },
    { date: '2024-01-19', earnings: 37700, sales: 1, views: 234 },
    { date: '2024-01-20', earnings: 37700, sales: 0, views: 198 },
    { date: '2024-01-21', earnings: 37700, sales: 0, views: 223 }
  ];

  // Initialize React components
  document.addEventListener('DOMContentLoaded', () => {
    // Render seller metric cards
    const earningsCardEl = document.getElementById('earnings-card');
    if (earningsCardEl) {
      const root = createRoot(earningsCardEl);
      root.render(
        React.createElement(EarningsCard, {
          totalEarnings: 45250,
          monthlyEarnings: 28500,
          trend: { value: 18.5, isPositive: true, label: 'vs last month' },
          onViewDetails: () => window.location.href = '/dashboard/seller/earnings'
        })
      );
    }

    const platformsCardEl = document.getElementById('platforms-card');
    if (platformsCardEl) {
      const root = createRoot(platformsCardEl);
      root.render(
        React.createElement(PlatformsCard, {
          total: 5,
          active: 3,
          trend: { value: 25.0, isPositive: true, label: 'new this month' },
          onManagePlatforms: () => window.location.href = '/dashboard/seller/listings'
        })
      );
    }

    const viewsCardEl = document.getElementById('views-card');
    if (viewsCardEl) {
      const root = createRoot(viewsCardEl);
      root.render(
        React.createElement(ViewsCard, {
          totalViews: 5420,
          weeklyViews: 1245,
          trend: { value: 12.3, isPositive: true, label: 'vs last week' },
          onOptimize: () => window.location.href = '/dashboard/seller/optimization'
        })
      );
    }

    const performanceCardEl = document.getElementById('performance-card');
    if (performanceCardEl) {
      const root = createRoot(performanceCardEl);
      root.render(
        React.createElement(PerformanceCard, {
          score: 87,
          rating: 4.8,
          trend: { value: 5.2, isPositive: true, label: 'this month' },
          onImprove: () => window.location.href = '/dashboard/seller/analytics'
        })
      );
    }

    // Render earnings chart
    const earningsChartEl = document.getElementById('earnings-chart');
    if (earningsChartEl) {
      const root = createRoot(earningsChartEl);
      root.render(
        React.createElement(EarningsChart, {
          data: mockEarningsData,
          period: '7d',
          totalEarnings: 45250,
          pendingPayouts: 28500,
          onPeriodChange: (period) => console.log('Period changed:', period)
        })
      );
    }
  });

  // Auto-refresh seller data
  setInterval(async () => {
    try {
      // Fetch fresh seller data
      const response = await fetch('/api/seller/dashboard?period=7d');
      const data = await response.json();

      // Update components with fresh data
      console.log('Seller dashboard data refreshed:', data);
    } catch (error) {
      console.error('Failed to refresh seller dashboard data:', error);
    }
  }, 60000); // Refresh every minute
</script>

<style>
  /* Seller-specific dashboard styles */
  .seller-dashboard-grid {
    display: grid;
    gap: 2rem;
  }

  /* Enhanced hover effects for seller cards */
  .seller-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .seller-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -12px rgba(251, 191, 36, 0.2);
  }

  /* Performance indicator animations */
  .performance-indicator {
    position: relative;
    overflow: hidden;
  }

  .performance-indicator::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.2), transparent);
    transition: left 0.5s;
  }

  .performance-indicator:hover::after {
    left: 100%;
  }

  /* Responsive adjustments for seller dashboard */
  @media (max-width: 1024px) {
    .seller-dashboard-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .seller-card {
      transform: none;
    }

    .seller-card:hover {
      transform: translateY(-2px);
    }
  }
</style>