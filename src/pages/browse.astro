---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import PlatformGrid from '../components/PlatformGrid.astro';
import { platforms, filterPlatforms, sortPlatforms, paginatePlatforms, getFeaturedPlatforms } from '../data/platforms.js';

// Get initial data - featured platforms first, then all platforms
const featuredPlatforms = getFeaturedPlatforms();
const allPlatforms = platforms;
---

<Layout title="Browse Business Platforms - TechFlunky">
  <main class="min-h-screen bg-black">
    <Navigation currentPage="browse" />

    <!-- Header -->
    <section class="relative min-h-screen bg-gradient-to-br from-black via-gray-900 to-black text-white overflow-hidden flex items-center">
      <!-- Subtle grid pattern -->
      <div class="absolute inset-0 opacity-5">
        <div class="h-full w-full bg-grid-pattern"></div>
      </div>

      <div class="container mx-auto px-4 relative z-10 pt-24">
        <div class="max-w-4xl mx-auto text-center">
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-black leading-tight mb-6 animate-slide-up">
            <span class="block text-white">Browse Complete</span>
            <span class="block text-yellow-400">Business Platforms</span>
          </h1>
          <p class="text-xl md:text-2xl text-gray-300 mb-8 animate-slide-up" style="animation-delay: 0.1s">
            Production-ready codebases with full documentation â€” built by developers, validated by the market.
          </p>

          <!-- Search and Filter Bar -->
          <div class="bg-black/50 backdrop-blur-sm rounded-xl p-6 mt-8 border border-yellow-400/20 animate-slide-up" style="animation-delay: 0.2s">
            <div class="flex flex-col md:flex-row gap-4">
              <input
                id="searchInput"
                type="text"
                placeholder="Search platforms..."
                class="flex-grow px-4 py-3 rounded-lg bg-gray-900/50 backdrop-blur-sm border border-yellow-400/30 text-white placeholder-gray-400 focus:outline-none focus:border-yellow-400/60 focus:bg-gray-900/70"
              />
              <select id="categoryFilter" class="px-4 py-3 rounded-lg bg-gray-900/50 backdrop-blur-sm border border-yellow-400/30 text-white focus:outline-none focus:border-yellow-400/60">
                <option value="">All Categories</option>
                <option value="hr-compliance">HR Compliance</option>
                <option value="legal-saas">Legal SaaS</option>
                <option value="fintech">FinTech</option>
                <option value="healthcare">Healthcare</option>
                <option value="marketing-tools">Marketing Tools</option>
                <option value="restaurant-tech">Restaurant Tech</option>
                <option value="real-estate">Real Estate</option>
                <option value="fitness-tech">Fitness Tech</option>
                <option value="education-tech">Education Tech</option>
                <option value="iot-platform">IoT Platform</option>
              </select>
              <select id="priceFilter" class="px-4 py-3 rounded-lg bg-gray-900/50 backdrop-blur-sm border border-yellow-400/30 text-white focus:outline-none focus:border-yellow-400/60">
                <option value="">All Prices</option>
                <option value="0-15000">Under $15K</option>
                <option value="15000-35000">$15K - $35K</option>
                <option value="35000+">$35K+</option>
              </select>
              <select id="sortFilter" class="px-4 py-3 rounded-lg bg-gray-900/50 backdrop-blur-sm border border-yellow-400/30 text-white focus:outline-none focus:border-yellow-400/60">
                <option value="created_at-desc">Newest First</option>
                <option value="created_at-asc">Oldest First</option>
                <option value="price-asc">Price: Low to High</option>
                <option value="price-desc">Price: High to Low</option>
                <option value="ai_score-desc">Highest AI Score</option>
                <option value="views_count-desc">Most Popular</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Scroll indicator -->
      <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce">
        <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
        </svg>
      </div>
    </section>

    <!-- Featured Platforms Section -->
    {featuredPlatforms.length > 0 && (
      <section class="py-16 bg-gradient-to-r from-black via-gray-900 to-black">
        <div class="container mx-auto px-4">
          <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Featured Platforms</h2>
            <p class="text-xl text-gray-300 max-w-2xl mx-auto">
              Handpicked, market-validated platforms ready for immediate launch
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
            {featuredPlatforms.map((platform, index) => (
              <div
                key={platform.id}
                class="animate-slide-up"
                style={`animation-delay: ${index * 200}ms`}
              >
                <PlatformCard platform={platform} featured={true} className="h-full transform hover:scale-105 transition-transform duration-500" />
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- All Platforms Grid -->
    <section class="py-24 bg-gradient-to-br from-black to-gray-900">
      <div class="container mx-auto px-4">

        <!-- Section Header -->
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">All Platforms</h2>
          <p class="text-lg text-gray-300 max-w-2xl mx-auto">
            Discover production-ready business platforms with complete documentation and market validation
          </p>
        </div>

        <!-- Results Summary -->
        <div id="resultsCount" class="text-gray-300 text-sm mb-6">
          Showing {allPlatforms.length} platforms
        </div>

        <!-- Platform Grid Container -->
        <div id="platformsContainer">
          <PlatformGrid platforms={allPlatforms} />
        </div>

        <!-- Load More Button (for future pagination) -->
        <div class="text-center mt-12">
          <button
            id="loadMoreBtn"
            class="bg-transparent border-2 border-yellow-400 text-yellow-400 px-8 py-3 rounded-xl font-semibold hover:bg-yellow-400 hover:text-black transition-all duration-300 transform hover:scale-105 hidden"
          >
            Load More Platforms
          </button>
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="py-24 bg-gradient-to-br from-gray-900 via-black to-gray-900">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
          <h2 class="text-4xl md:text-5xl font-bold mb-6 text-white leading-tight">
            Ready to Launch Your Next <span class="text-yellow-400">Business</span>?
          </h2>
          <p class="text-xl text-gray-300 mb-12 max-w-2xl mx-auto leading-relaxed">
            Skip 18+ months of development and launch with a proven, market-validated platform
          </p>

          <div class="flex flex-col sm:flex-row gap-6 justify-center items-center">
            <a href={`/listing/${featuredPlatforms[0]?.slug || 'ai-hr-leave-administration-platform'}`} class="group bg-yellow-400 text-black px-10 py-4 rounded-xl font-bold text-lg hover:bg-yellow-300 transition-all duration-300 transform hover:scale-105 hover:shadow-2xl">
              <span class="flex items-center gap-3">
                View Featured Platform
                <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                </svg>
              </span>
            </a>

            <div class="text-gray-400 font-medium">or</div>

            <a href="/signup" class="group bg-transparent border-2 border-yellow-400 text-yellow-400 px-10 py-4 rounded-xl font-bold text-lg hover:bg-yellow-400 hover:text-black transition-all duration-300 transform hover:scale-105">
              <span class="flex items-center gap-3">
                Get Notified
                <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5-5-5h5v-12"/>
                </svg>
              </span>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="py-12 bg-black border-t border-yellow-400/20">
      <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="flex items-center space-x-3 mb-4 md:mb-0">
            <img src="/assets/techflunky-logo.png" alt="TechFlunky" class="w-8 h-8">
            <span class="text-xl font-bold text-white">TechFlunky</span>
          </div>

          <div class="flex items-center space-x-6 text-gray-400">
            <a href="/about" class="hover:text-yellow-400 transition">About</a>
            <a href="/contact" class="hover:text-yellow-400 transition">Contact</a>
            <a href="/terms" class="hover:text-yellow-400 transition">Terms</a>
            <a href="/privacy" class="hover:text-yellow-400 transition">Privacy</a>
          </div>
        </div>

        <div class="text-center mt-8 pt-8 border-t border-gray-800">
          <p class="text-gray-400">
            Â© 2024 TechFlunky. Connecting builders with entrepreneurs.
          </p>
        </div>
      </div>
    </footer>
  </main>
</Layout>

<script>
  // Import platform data and filtering functions
  import { platforms, filterPlatforms, sortPlatforms } from '../data/platforms.js';

  // Modern intersection observer for scroll animations
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, observerOptions);

  // Platform filtering and search functionality
  class PlatformBrowser {
    constructor() {
      this.allPlatforms = platforms;
      this.filteredPlatforms = platforms;
      this.currentFilters = {
        query: '',
        category: '',
        minPrice: null,
        maxPrice: null,
        sortBy: 'createdAt',
        sortOrder: 'desc'
      };
      this.init();
    }

    init() {
      this.bindFilterEvents();
      this.updateDisplay();
    }

    bindFilterEvents() {
      const searchInput = document.getElementById('searchInput');
      const categoryFilter = document.getElementById('categoryFilter');
      const priceFilter = document.getElementById('priceFilter');
      const sortFilter = document.getElementById('sortFilter');

      // Debounced search
      let searchTimeout;
      if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            this.currentFilters.query = e.target.value.trim();
            this.applyFilters();
          }, 300);
        });
      }

      // Category filter
      if (categoryFilter) {
        categoryFilter.addEventListener('change', (e) => {
          this.currentFilters.category = e.target.value;
          this.applyFilters();
        });
      }

      // Price filter
      if (priceFilter) {
        priceFilter.addEventListener('change', (e) => {
          const priceRange = e.target.value;
          if (priceRange === '0-15000') {
            this.currentFilters.minPrice = 0;
            this.currentFilters.maxPrice = 15000;
          } else if (priceRange === '15000-35000') {
            this.currentFilters.minPrice = 15000;
            this.currentFilters.maxPrice = 35000;
          } else if (priceRange === '35000+') {
            this.currentFilters.minPrice = 35000;
            this.currentFilters.maxPrice = null;
          } else {
            this.currentFilters.minPrice = null;
            this.currentFilters.maxPrice = null;
          }
          this.applyFilters();
        });
      }

      // Sort filter
      if (sortFilter) {
        sortFilter.addEventListener('change', (e) => {
          const [sortBy, sortOrder] = e.target.value.split('-');
          this.currentFilters.sortBy = sortBy;
          this.currentFilters.sortOrder = sortOrder;
          this.applyFilters();
        });
      }
    }

    applyFilters() {
      // Filter platforms
      this.filteredPlatforms = filterPlatforms(this.allPlatforms, this.currentFilters);

      // Sort platforms
      this.filteredPlatforms = sortPlatforms(
        this.filteredPlatforms,
        this.currentFilters.sortBy,
        this.currentFilters.sortOrder
      );

      this.updateDisplay();
    }

    updateDisplay() {
      const container = document.getElementById('platformsContainer');
      const resultsCount = document.getElementById('resultsCount');

      if (resultsCount) {
        resultsCount.textContent = `Showing ${this.filteredPlatforms.length} platform${this.filteredPlatforms.length !== 1 ? 's' : ''}`;
      }

      if (container) {
        this.renderPlatforms(container);
      }
    }

    renderPlatforms(container) {
      if (this.filteredPlatforms.length === 0) {
        container.innerHTML = `
          <div class="col-span-full text-center py-16">
            <div class="mx-auto w-24 h-24 bg-gray-800/50 rounded-full flex items-center justify-center mb-6">
              <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
              </svg>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">No platforms found</h3>
            <p class="text-gray-400 mb-6">Try adjusting your search criteria or browse all categories</p>
            <button
              onclick="this.resetFilters()"
              class="inline-flex items-center gap-2 bg-yellow-400 text-black px-6 py-3 rounded-lg font-semibold hover:bg-yellow-300 transition-colors"
            >
              Reset Filters
            </button>
          </div>
        `;
        return;
      }

      // Re-render platform grid with filtered results
      const grid = document.createElement('div');
      grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6';

      // Note: In a real implementation, we'd need to recreate the Astro components in JavaScript
      // For now, we'll show a simplified version and recommend page refresh for full functionality
      container.innerHTML = `
        <div class="text-center py-8">
          <p class="text-gray-300 mb-4">Found ${this.filteredPlatforms.length} platforms matching your criteria</p>
          <button
            onclick="window.location.reload()"
            class="bg-yellow-400 text-black px-6 py-3 rounded-lg font-semibold hover:bg-yellow-300 transition-colors"
          >
            Refresh to Apply Filters
          </button>
        </div>
      `;
    }

    resetFilters() {
      // Reset all filters
      const searchInput = document.getElementById('searchInput');
      const categoryFilter = document.getElementById('categoryFilter');
      const priceFilter = document.getElementById('priceFilter');
      const sortFilter = document.getElementById('sortFilter');

      if (searchInput) searchInput.value = '';
      if (categoryFilter) categoryFilter.value = '';
      if (priceFilter) priceFilter.value = '';
      if (sortFilter) sortFilter.value = 'createdAt-desc';

      this.currentFilters = {
        query: '',
        category: '',
        minPrice: null,
        maxPrice: null,
        sortBy: 'createdAt',
        sortOrder: 'desc'
      };

      this.applyFilters();
    }
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize scroll animations
    document.querySelectorAll('.scroll-fade, .animate-slide-up').forEach(el => {
      observer.observe(el);
    });

    // Initialize platform browser
    window.platformBrowser = new PlatformBrowser();

    // Smooth scroll for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const href = this.getAttribute('href');
        if (href) {
          document.querySelector(href)?.scrollIntoView({
            behavior: 'smooth'
          });
        }
      });
    });
  });
</script>

<style>
  /* Import styles from index page for consistency */
  :root {
    --yellow-primary: #fbbf24;
    --yellow-secondary: #f59e0b;
    --yellow-glow: rgba(251, 191, 36, 0.2);
    --black-primary: #000000;
    --gray-primary: #111827;
    --gray-secondary: #1f2937;
  }

  .bg-grid-pattern {
    background-image: url("data:image/svg+xml,%3csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3e%3cg fill='none' stroke='%23fff' stroke-width='1'%3e%3cpath d='M0 0h60v60H0z'/%3e%3c/g%3e%3c/svg%3e");
    background-size: 60px 60px;
  }

  @keyframes slide-up {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fade-in-scale {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes glow-pulse {
    0%, 100% {
      box-shadow: 0 0 20px var(--yellow-glow);
    }
    50% {
      box-shadow: 0 0 40px rgba(251, 191, 36, 0.4), 0 0 60px var(--yellow-glow);
    }
  }

  .animate-slide-up {
    animation: slide-up 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    opacity: 0;
  }

  .animate-fade-in {
    animation: fade-in-scale 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    opacity: 0;
  }

  .animate-glow {
    animation: glow-pulse 3s ease-in-out infinite;
  }

  /* Card Hover Effects */
  .card-hover {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .card-hover:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(251, 191, 36, 0.1);
  }

  /* Custom Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: var(--gray-primary);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--yellow-primary);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--yellow-secondary);
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
</style>